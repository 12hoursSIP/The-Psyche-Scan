const i18n = {
    'en': {
        begin: "I am ready", chapter: "Chapter", hint: "Click the core to reveal the truth", reset: "Return to the Shadows",
        labels: ["Vitality", "Innovation", "Stability"],
        pNames: ["The Kinetic Catalyst", "The Analytical Mystic", "The Adaptive Chameleon"],
        pMasks: [
            "<b>Projected Social Construct:</b> You utilize a high-arousal behavioral mask to facilitate social cohesion. You subconsciously drive the collective emotional momentum.",
            "<b>Projected Social Construct:</b> You maintain a low-arousal facade. This 'observer-mode' allows you to process data without the requirement of performance.",
            "<b>Projected Social Construct:</b> You possess an elite degree of social intelligence, mirroring the energy of any environment with effortless precision."
        ],
        pCores: [
            "<b>Internal Regulatory Mechanism:</b> This vitality serves as a defense against fragility. You transmute psychological friction into brilliant light.",
            "<b>Internal Regulatory Mechanism:</b> Your stillness is a deliberate boundary. You prioritize a high-complexity internal landscape where visions can grow undisturbed.",
            "<b>Internal Regulatory Mechanism:</b> You prioritize harmony over individual ego. Your work is defining your silhouette once the mirrors of others are removed."
        ],
        qs: [
            { t: "You stand before a heavy oak door at a social gathering. How do you prepare?", o: ["I project a confident smile", "I wait to slip in unnoticed", "I adjust my clothes to stand out", "I remind myself I can leave anytime"] },
            { t: "Inside, a group is laughing loudly. How do you engage?", o: ["I walk straight in and join them", "I stand on the edge and listen", "I look for a unique opening", "I head to the drinks for a task"] },
            { t: "A stranger mistakes you for someone else. Your reaction?", o: ["I play along for entertainment", "I politely correct them", "I reinvent myself for the night", "I offer a vague, mysterious answer"] },
            { t: "You find a mirror reflecting your 'inner hunger'. What do you see?", o: ["A blazing fire seeking to consume", "A deep, still ocean demanding silence", "A sky of stars shifting patterns", "A single candle burning in the dark"] },
            { t: "Someone spills a drink on you. All eyes are on you.", o: ["I make a joke to keep it light", "I excuse myself to clean in private", "I start a philosophical talk", "I shrug it off; it doesn't touch me"] },
            { t: "The music shifts to a haunting melody. Your mind drifts to...", o: ["A memory of a past love", "The physical sensation of rhythm", "A future world not yet built", "The exit; I'm feeling drained"] },
            { t: "You find a book titled 'The Truth of You'. Which page first?", o: ["My greatest achievements", "My most private reflections", "My wildest secret dreams", "The people who shaped me"] },
            { t: "An old friend appears but doesn't recognize your persona.", o: ["I drop the act and embrace them", "I stay in character to test them", "I feel relief that I've changed", "I avoid them to stay in the new me"] },
            { t: "The host announces a final toast. You celebrate...", o: ["The connections I've made", "Remaining true to myself", "Inspiration for a new project", "The simple beauty of the end"] },
            { t: "The sun rises as you leave. How do you feel?", o: ["Energized for the new day", "Peaceful, returning to solitude", "Mysterious, as if I left part of me", "Exhausted but satisfied"] }
        ]
    },
    'zh-Hans': {
        begin: "我准备好了", chapter: "章节", hint: "点击核心以揭示真相", reset: "回归阴影",
        labels: ["生命力", "创新力", "稳定性"],
        pNames: ["动态催化剂", "解析智者", "自适应变色龙"],
        pMasks: [
            "<b>社交人格投影：</b>你利用高唤醒度的行为掩饰来促进社交凝聚力。你在潜意识中驱动着集体的情感动量",
            "<b>社交人格投影：</b>你保持着低唤醒、稳定的社交门面。这种“观察模式”让你在无需表演的情况下处理环境信息",
            "<b>社交人格投影：</b>你拥有精英级别的社交智慧，能以精准的效率与任何环境的能量同步镜像"
        ],
        pCores: [
            "<b>内部调节机制：</b>这种活力是针对内在脆弱性的高级防御。你将心理摩擦转化为灿烂的光芒",
            "<b>内部调节机制：</b>你的静止是一种刻意的边界。你优先构建高复杂度的内在景观，让愿景在不受干扰的情况下成长",
            "<b>内部调节机制：</b>你将整体和谐置于个人自我之上。你的挑战是在他人的镜子移除后，找回自己的轮廓"
        ],
        qs: [
            { t: "聚会前，你站在大门前。进入之前，你如何准备", o: ["展现自信的微笑", "悄无声息地进入", "整理衣装以脱颖而出", "提醒自己可以随时离开"] },
            { t: "聚会中有人大笑，你如何加入", o: ["直接加入谈话", "在边缘观察倾听", "寻找独特的切入点", "先去拿杯饮料缓解"] },
            { t: "陌生人认错了你。你如何应对", o: ["顺势而为，享受乐趣", "礼貌地纠正对方", "趁机重塑今晚的身份", "给出模棱两可的回答"] },
            { t: "镜子照出你的内在渴望。你看到了什么", o: ["试图吞噬一切的烈火", "要求沉静的深海", "变换图案的星空", "黑暗中稳定的烛光"] },
            { t: "有人把饮料洒在你身上。大家的目光都看向你", o: ["开个玩笑缓解气氛", "去私人空间清理", "展开一段哲学对话", "耸耸肩，这不影响我"] },
            { t: "音乐变得忧郁。你的思绪飘向了", o: ["一段过去的爱情回忆", "节奏带来的肉体感受", "尚未构建的未来世界", "出口；我感到疲倦了"] },
            { t: "书名是《真实的你》。你先翻开哪一页", o: ["我最伟大的成就", "我最私密的沉思", "我最狂野的梦想", "塑造过我的那些人"] },
            { t: "老友出现但没认出你。你如何反应", o: ["放下伪装去拥抱", "继续演戏测试对方", "为改变感到一种解脱", "避开他们以维持现状"] },
            { t: "最后的祝酒。你在庆祝什么", o: ["今晚建立的联系", "保持真实的自我", "新项目的灵感", "结束时的简单纯粹"] },
            { t: "太阳升起，你离开。此时的感觉是", o: ["充满活力迎接新一天", "宁静地回归孤独", "神秘，仿佛留下了什么", "疲惫但对表现很满意"] }
        ]
    },
    'zh-Hant': {
        begin: "我準備好了", chapter: "章節", hint: "點擊核心以揭示真相", reset: "回歸陰影",
        labels: ["生命力", "創新力", "穩定性"],
        pNames: ["動態催化劑", "解析智者", "自適應變色龍"],
        pMasks: [
            "<b>社交人格投影：</b>你利用高喚醒度的行為掩飾來促進社交凝聚力。你在潛意識中驅動著集體的情感動量",
            "<b>社交人格投影：</b>你保持著低喚醒、穩定的社交門面。這種「觀察模式」讓你在無需表演的情況下處理環境信息",
            "<b>社交人格投影：</b>你擁有精英級別的社交智慧，能以精準的效率與任何環境的能量同步鏡像"
        ],
        pCores: [
            "<b>內部調節機制：</b>這種活力是針對內在脆弱性的高級防禦。你將心理摩擦轉化為燦爛的光芒",
            "<b>內部調節機制：</b>你的靜止是一種刻意的邊界。你優先構建高複雜度的內部景觀，讓願景在不受干擾的情況下成長",
            "<b>內部調節機制：</b>你將整體的和諧置於個人自我之上。你的挑戰是在他人的鏡子移除後，找回自己的輪廓"
        ],
        qs: [
            { t: "聚會前，你站在大門前。進入之前，你如何準備", o: ["展現自信的微笑", "悄無聲息地進入", "整理衣裝以脫穎而出", "提醒自己可以隨時離開"] },
            { t: "聚會中有人大笑，你如何加入", o: ["直接加入談話", "在邊緣觀察傾聽", "尋找獨特的切入點", "先去拿杯飲料緩解"] },
            { t: "陌生人認錯了你。你如何應對", o: ["順勢而為，享受樂趣", "禮貌地糾正對方", "趁機重塑今晚的身份", "給出模稜兩可的回答"] },
            { t: "鏡子照出你的內在渴望。你看到了什麼", o: ["試圖吞噬一切的烈火", "要求沈靜的深海", "變換圖案的星空", "黑暗中穩定的燭光"] },
            { t: "有人把飲料灑在你身上。大家的目光都看向你", o: ["開個玩笑緩解氣氛", "去私人空間清理", "展開一段哲學對話", "聳聳肩，這不影響我"] },
            { t: "音樂變得憂郁。你的思緒飄向了", o: ["一段過去的愛情回憶", "節奏帶來的肉體感受", "尚未構建的未來世界", "出口；我感到疲倦了"] },
            { t: "書名是《真實的你》。你先翻開哪一頁", o: ["我最偉大的成就", "我最私密的沉思", "我最狂野的夢想", "塑造過我的那些人"] },
            { t: "老友出現但沒認出你。你如何反應", o: ["放下偽裝去擁抱", "繼續演戲測試對手", "為改變感到一種解脫", "避開他們以維持現狀"] },
            { t: "最後的祝酒。你在慶祝什麼", o: ["今晚建立的聯繫", "保持真實的自我", "新項目的靈感", "結束時的簡單純粹"] },
            { t: "太陽升起，你離開。此時的感覺是", o: ["充滿活力迎接新一天", "寧靜地回歸孤獨", "神秘，彷彿留下了什麼", "疲憊但對表現很滿意"] }
        ]
    }
};

let currentLang = 'en', rawScores = { energy: 10, creative: 10, calm: 10 }, currentStep = 0, mouseX = 0, mouseY = 0;

document.addEventListener('mousemove', (e) => {
    mouseX = e.clientX;
    mouseY = e.clientY;
    requestAnimationFrame(updateInteractiveElements);
});

function updateInteractiveElements() {
    const aura = document.getElementById('cursor-aura'), wrapper = document.getElementById('result-wrapper');
    if (aura) aura.style.transform = `translate3d(${mouseX}px, ${mouseY}px, 0) translate(-50%, -50%)`;
    if (wrapper && !document.getElementById('result-container').classList.contains('hidden')) {
        const rect = wrapper.getBoundingClientRect();
        wrapper.style.transform = `rotateY(${(mouseX - (rect.left + rect.width / 2)) / 15}deg) rotateX(${-(mouseY - (rect.top + rect.height / 2)) / 15}deg)`;
    }
}

function setLanguage(lang) {
    currentLang = lang;
    const data = i18n[lang];
    document.getElementById('ui-begin').innerText = data.begin;
    document.getElementById('ui-begin').classList.remove('hidden');
    document.getElementById('ui-chapter').innerText = data.chapter;
    document.getElementById('ui-hint').innerText = data.hint;
    document.getElementById('ui-reset').innerText = data.reset;
    document.getElementById('label-energy').innerText = data.labels[0];
    document.getElementById('label-creative').innerText = data.labels[1];
    document.getElementById('label-calm').innerText = data.labels[2];
}

function startJourney() {
    document.getElementById('intro-container').style.opacity = 0;
    setTimeout(() => {
        document.getElementById('intro-container').classList.add('hidden');
        document.getElementById('quiz-container').classList.remove('hidden');
        initQuiz();
    }, 800);
}

function initQuiz() {
    const container = document.getElementById('quiz-container'), q = i18n[currentLang].qs[currentStep];
    container.style.opacity = 0;
    setTimeout(() => {
        document.getElementById('chapter-num').innerText = currentStep + 1;
        document.getElementById('question-text').innerText = q.t;
        const grid = document.getElementById('options-grid'); grid.innerHTML = '';
        const hues = [45, 200, 280, 160];
        q.o.forEach((opt, i) => {
            const btn = document.createElement('button'); btn.innerText = opt;
            btn.onmouseenter = () => { document.documentElement.style.setProperty('--cursor-h', hues[i]); setBG(hues[i]); };
            btn.onmouseleave = updateVisuals;
            btn.onclick = () => { 
                const keys = ['energy', 'calm', 'creative', 'calm']; 
                rawScores[keys[i]] += 30; currentStep++;
                if (currentStep < 10) initQuiz(); else showResult();
            };
            grid.appendChild(btn);
        });
        container.style.opacity = 1;
    }, 250);
}

function setBG(h) {
    const root = document.documentElement;
    root.style.setProperty('--h1', h);
    root.style.setProperty('--h2', h + 45);
    root.style.setProperty('--h3', h - 45);
}

function updateVisuals() {
    const total = rawScores.energy + rawScores.creative + rawScores.calm, root = document.documentElement;
    root.style.setProperty('--h1', (rawScores.energy / total) * 120);
    root.style.setProperty('--h2', 240 + (rawScores.creative / total) * 80);
    root.style.setProperty('--h3', 180 + (rawScores.calm / total) * 60);
}

function showResult() {
    document.getElementById('quiz-container').classList.add('hidden');
    document.getElementById('result-container').classList.remove('hidden');
    const total = rawScores.energy + rawScores.creative + rawScores.calm,
          pE = Math.round((rawScores.energy / total) * 100),
          pC = Math.round((rawScores.creative / total) * 100),
          pL = Math.round((rawScores.calm / total) * 100);
    
    const data = i18n[currentLang], idx = pE > 38 && pC > 30 ? 0 : (pL > 38 && pC > 30 ? 1 : 2);
    document.getElementById('personality-name').innerText = data.pNames[idx];
    document.getElementById('mask-explanation').innerHTML = data.pMasks[idx];
    document.getElementById('core-truth').innerHTML = data.pCores[idx];
    
    document.getElementById('result-circle').style.background = `conic-gradient(from 0deg, hsl(45,80%,50%), hsl(280,80%,50%), hsl(190,80%,50%), hsl(45,80%,50%))`;

    setTimeout(() => {
        document.getElementById('bar-energy').style.width = pE + "%";
        document.getElementById('bar-creative').style.width = pC + "%";
        document.getElementById('bar-calm').style.width = pL + "%";
        document.getElementById('percent-energy').innerText = pE + "%";
        document.getElementById('percent-creative').innerText = pC + "%";
        document.getElementById('percent-calm').innerText = pL + "%";
    }, 500);
    
    document.getElementById('result-circle').onclick = () => {
        document.getElementById('core-truth').classList.add('unmasked');
        document.getElementById('result-circle').style.filter = "blur(4px)";
        document.querySelector('.hint-text').style.opacity = "0";
    };
    updateVisuals();
}

window.onload = updateVisuals;

